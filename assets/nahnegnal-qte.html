<!DOCTYPE html>
<html>
<head>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

  * { margin: 0; padding: 0; }

  body {
    background: transparent;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    font-family: 'Press Start 2P', monospace;
  }

  .scene {
    position: relative;
    width: 100%;
    height: 100%;
  }

  /* Nahn character - pixel art style face */
  .nahn {
    position: absolute;
    bottom: 100px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 120px;
    animation: shake 0.1s infinite;
  }

  .nahn.calm {
    animation: bob 2s ease-in-out infinite;
  }

  .nahn.stressed {
    animation: shake 0.05s infinite, sweat 0.5s ease-in-out infinite;
  }

  .nahn.rage {
    animation: rage-shake 0.03s infinite;
    filter: hue-rotate(320deg) saturate(2);
  }

  @keyframes bob {
    0%, 100% { transform: translateX(-50%) translateY(0); }
    50% { transform: translateX(-50%) translateY(-10px); }
  }

  @keyframes shake {
    0% { transform: translateX(-50%) rotate(-2deg); }
    50% { transform: translateX(-50%) rotate(2deg); }
    100% { transform: translateX(-50%) rotate(-2deg); }
  }

  @keyframes rage-shake {
    0% { transform: translateX(-50%) rotate(-5deg) scale(1.1); }
    25% { transform: translateX(-48%) rotate(3deg) scale(1.05); }
    50% { transform: translateX(-52%) rotate(-3deg) scale(1.1); }
    75% { transform: translateX(-50%) rotate(5deg) scale(1.05); }
    100% { transform: translateX(-50%) rotate(-5deg) scale(1.1); }
  }

  /* QTE Prompts */
  .qte-container {
    position: absolute;
    top: 50px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    justify-content: center;
    max-width: 800px;
  }

  .qte-button {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    font-weight: bold;
    color: white;
    text-shadow: 2px 2px 0 black;
    opacity: 0;
    transform: scale(0);
    transition: all 0.1s;
  }

  .qte-button.active {
    opacity: 1;
    transform: scale(1);
    animation: pulse-urgent 0.3s ease-in-out infinite;
  }

  .qte-button.missed {
    animation: missed 0.5s ease-out forwards;
    background: #333 !important;
  }

  .qte-button.success {
    animation: success 0.3s ease-out forwards;
  }

  .btn-a { background: linear-gradient(135deg, #4CAF50, #2E7D32); }
  .btn-b { background: linear-gradient(135deg, #f44336, #c62828); }
  .btn-x { background: linear-gradient(135deg, #2196F3, #1565C0); }
  .btn-y { background: linear-gradient(135deg, #FFEB3B, #F9A825); color: #333; }
  .btn-l { background: linear-gradient(135deg, #9C27B0, #6A1B9A); }
  .btn-r { background: linear-gradient(135deg, #FF9800, #E65100); }

  @keyframes pulse-urgent {
    0%, 100% { transform: scale(1); box-shadow: 0 0 20px currentColor; }
    50% { transform: scale(1.15); box-shadow: 0 0 40px currentColor, 0 0 60px currentColor; }
  }

  @keyframes missed {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.5); opacity: 0.5; }
    100% { transform: scale(0); opacity: 0; }
  }

  @keyframes success {
    0% { transform: scale(1); }
    50% { transform: scale(1.3); filter: brightness(2); }
    100% { transform: scale(0); opacity: 0; }
  }

  /* Sweat drops */
  .sweat {
    position: absolute;
    font-size: 30px;
    opacity: 0;
    animation: sweat-drop 1s ease-in infinite;
  }

  .sweat-1 { left: calc(50% - 80px); top: 200px; animation-delay: 0s; }
  .sweat-2 { left: calc(50% + 60px); top: 180px; animation-delay: 0.3s; }
  .sweat-3 { left: calc(50% - 60px); top: 220px; animation-delay: 0.6s; }

  @keyframes sweat-drop {
    0% { opacity: 0; transform: translateY(0); }
    20% { opacity: 1; }
    100% { opacity: 0; transform: translateY(100px); }
  }

  /* Stress meter */
  .stress-meter {
    position: absolute;
    top: 20px;
    right: 20px;
    width: 30px;
    height: 200px;
    background: #333;
    border: 3px solid #fff;
    border-radius: 15px;
    overflow: hidden;
  }

  .stress-fill {
    position: absolute;
    bottom: 0;
    width: 100%;
    background: linear-gradient(to top, #4CAF50, #FFEB3B, #f44336);
    transition: height 0.3s;
  }

  .stress-label {
    position: absolute;
    top: 230px;
    right: 10px;
    font-size: 10px;
    color: #fff;
    text-shadow: 1px 1px 0 #000;
  }

  /* Thought bubble */
  .thought {
    position: absolute;
    bottom: 280px;
    left: 50%;
    transform: translateX(-50%);
    background: white;
    padding: 15px 25px;
    border-radius: 20px;
    font-size: 14px;
    color: #333;
    opacity: 0;
    transition: opacity 0.3s;
  }

  .thought::after {
    content: '';
    position: absolute;
    bottom: -20px;
    left: 50%;
    transform: translateX(-50%);
    border: 10px solid transparent;
    border-top-color: white;
  }

  .thought.visible {
    opacity: 1;
    animation: thought-bounce 0.5s ease-out;
  }

  @keyframes thought-bounce {
    0% { transform: translateX(-50%) translateY(20px); opacity: 0; }
    100% { transform: translateX(-50%) translateY(0); opacity: 1; }
  }

  /* Screen shake on miss */
  .scene.screen-shake {
    animation: screen-shake 0.3s ease-out;
  }

  @keyframes screen-shake {
    0%, 100% { transform: translate(0, 0); }
    20% { transform: translate(-10px, 5px); }
    40% { transform: translate(10px, -5px); }
    60% { transform: translate(-5px, 10px); }
    80% { transform: translate(5px, -10px); }
  }

  /* Mario & Luigi logo */
  .game-logo {
    position: absolute;
    top: 160px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 16px;
    color: #ff6b6b;
    text-shadow: 2px 2px 0 #000;
    opacity: 0.8;
  }
</style>
</head>
<body>

<div class="scene" id="scene">
  <div class="stress-meter">
    <div class="stress-fill" id="stressFill" style="height: 20%"></div>
  </div>
  <div class="stress-label">STRESS</div>

  <div class="game-logo">MARIO & LUIGI QTE HELL</div>

  <div class="qte-container" id="qteContainer">
    <div class="qte-button btn-a" id="btnA">A</div>
    <div class="qte-button btn-b" id="btnB">B</div>
    <div class="qte-button btn-x" id="btnX">X</div>
    <div class="qte-button btn-y" id="btnY">Y</div>
    <div class="qte-button btn-l" id="btnL">L</div>
    <div class="qte-button btn-r" id="btnR">R</div>
  </div>

  <div class="thought" id="thought">WHY SO FAST?!</div>

  <div class="nahn calm" id="nahn">üò∞</div>

  <div class="sweat sweat-1">üíß</div>
  <div class="sweat sweat-2">üíß</div>
  <div class="sweat sweat-3">üíß</div>
</div>

<script>
const faces = {
  calm: 'üòê',
  focused: 'üò§',
  stressed: 'üò∞',
  panic: 'üò±',
  rage: 'ü§¨',
  relief: 'üòÆ‚Äçüí®',
  dead: 'üíÄ'
};

const thoughts = [
  "WHY SO FAST?!",
  "IMPOSSIBLE!!",
  "MY FINGERS!!!",
  "NOT AGAIN...",
  "LEVEL 1 BTW",
  "THIS IS FINE",
  "HELP ME",
  "TOO MANY BUTTONS",
  "I PRESSED IT!!",
  "LAG!!! (cope)",
  "WHO DESIGNED THIS",
  "AAAAAAHHH"
];

const buttons = ['A', 'B', 'X', 'Y', 'L', 'R'];
const btnElements = {
  A: document.getElementById('btnA'),
  B: document.getElementById('btnB'),
  X: document.getElementById('btnX'),
  Y: document.getElementById('btnY'),
  L: document.getElementById('btnL'),
  R: document.getElementById('btnR')
};

const nahn = document.getElementById('nahn');
const scene = document.getElementById('scene');
const stressFill = document.getElementById('stressFill');
const thought = document.getElementById('thought');

let stress = 20;
let activeButtons = [];
let qteSpeed = 2000; // ms per QTE

function updateStress(delta) {
  stress = Math.max(0, Math.min(100, stress + delta));
  stressFill.style.height = stress + '%';

  // Update face based on stress
  nahn.className = 'nahn';
  if (stress < 30) {
    nahn.textContent = faces.calm;
    nahn.classList.add('calm');
  } else if (stress < 50) {
    nahn.textContent = faces.focused;
    nahn.classList.add('calm');
  } else if (stress < 70) {
    nahn.textContent = faces.stressed;
    nahn.classList.add('stressed');
  } else if (stress < 90) {
    nahn.textContent = faces.panic;
    nahn.classList.add('stressed');
  } else {
    nahn.textContent = faces.rage;
    nahn.classList.add('rage');
  }
}

function showThought() {
  thought.textContent = thoughts[Math.floor(Math.random() * thoughts.length)];
  thought.classList.add('visible');
  setTimeout(() => thought.classList.remove('visible'), 2000);
}

function spawnQTE() {
  // Random number of buttons (1-4)
  const count = Math.min(Math.floor(stress / 25) + 1, 4);
  const selectedButtons = [];

  for (let i = 0; i < count; i++) {
    let btn;
    do {
      btn = buttons[Math.floor(Math.random() * buttons.length)];
    } while (selectedButtons.includes(btn));
    selectedButtons.push(btn);
  }

  // Activate buttons
  selectedButtons.forEach((btn, i) => {
    setTimeout(() => {
      btnElements[btn].classList.add('active');
      activeButtons.push(btn);
    }, i * 100);
  });

  // Speed up as stress increases
  const timeout = Math.max(500, qteSpeed - (stress * 15));

  // Resolve QTE
  setTimeout(() => {
    const success = Math.random() > (stress / 150 + 0.2); // Higher stress = more fails

    selectedButtons.forEach(btn => {
      if (success) {
        btnElements[btn].classList.remove('active');
        btnElements[btn].classList.add('success');
        setTimeout(() => btnElements[btn].classList.remove('success'), 300);
      } else {
        btnElements[btn].classList.remove('active');
        btnElements[btn].classList.add('missed');
        setTimeout(() => btnElements[btn].classList.remove('missed'), 500);
      }
    });

    if (success) {
      updateStress(-5);
      if (Math.random() > 0.7) {
        nahn.textContent = faces.relief;
      }
    } else {
      updateStress(15);
      scene.classList.add('screen-shake');
      setTimeout(() => scene.classList.remove('screen-shake'), 300);
      if (Math.random() > 0.5) {
        showThought();
      }
    }

    activeButtons = [];
  }, timeout);
}

// Main loop
function gameLoop() {
  spawnQTE();

  // Random interval between QTEs (faster as stress increases)
  const nextQTE = Math.max(800, 2500 - stress * 15);
  setTimeout(gameLoop, nextQTE);
}

// Occasional stress decay
setInterval(() => {
  if (stress > 20) {
    updateStress(-2);
  }
}, 3000);

// Occasional random stress spike
setInterval(() => {
  if (Math.random() > 0.7) {
    updateStress(10);
    showThought();
  }
}, 5000);

// Start
setTimeout(gameLoop, 1000);
</script>
</body>
</html>
